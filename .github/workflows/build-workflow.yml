on:
  push:
    branches: [ php-7.4-ubuntu-20.04 ]
    
env:
  REPO: "orangehrm/orangehrm-environment-images"
  TAG: "prod-php-7.4-ubuntu20.04" 
  //DOCKER_USERNAME: ${{secrets.DOCKER_USER}}
  //DOCKER_PASSWORD: ${{secrets.DOCKER_PASSWORD}}
  Docker_HUB_REPO: "us95123/orangehrm-environment-images"
  
jobs:

    build:

      runs-on: ubuntu-latest
      steps: 
       
       - name: Get the checkout  
         uses: actions/checkout@v3

       - name: Prerequisites
         run: |
           uname -a
           php --version
           docker --version
           docker-compose --version
           composer --version

       - name: Install test suite dependencies
         run: |
           composer update
           composer install
           docker ps        
        
       - name: Build docker image
         run: docker build -t ${{ env.REPO }}:${{ env.TAG }} docker-image  

       - name: Up the container
         run: |
           docker-compose up -d
           docker ps

       - name: Unit test 
         run: php vendor/bin/codecept run unit

       - name: Push Docker image to Docker Hub
       - name: Log in to Docker Hub
         run: docker login 

       - name: Tag the image
         run: docker tag ${{ env.REPO }}:${{ env.TAG }} ${{ env.DOCKER_HUB_REPO }}:${{ env.TAG }}

       - name: Push the images
         run: docker push ${{ env.DOCKER_HUB_REPO }}:${{ env.TAG }}
       
      